steps:
  - name: initialize
    action: execute
    file: recipe-steps/dev/init.sh

  - name: make the build file
    change_directory: join-stream
    action: make_file
    file: build.gradle

  - name: set up the gradle wrapper
    action: execute
    file: recipe-steps/dev/gradle-wrapper.sh

  - name: make the configuration directory
    action: execute
    file: recipe-steps/dev/make-configuration-dir.sh

  - name: make the dev props file
    action: make_file
    file: configuration/dev.properties

  - name: make a directory for Avro files
    action: execute
    file: recipe-steps/dev/make-avro-dir.sh

  - name: make movie schema
    action: make_file
    file: src/main/avro/movie.avsc

  - name: make rating schema
    action: make_file
    file: src/main/avro/rating.avsc

  - name: make rated movie schema
    action: make_file
    file: src/main/avro/rated-movie.avsc

  - name: build the project
    action: execute
    file: recipe-steps/dev/build-project.sh

  - name: make the source directory
    action: execute
    file: recipe-steps/dev/make-src-dir.sh

  - name: make the main Java file
    action: make_file
    file: src/main/java/io/confluent/developer/JoinStreamToTable.java

  - name: make the joiner Java file
    action: make_file
    file: src/main/java/io/confluent/developer/MovieRatingJoiner.java

  - name: make an uberjar
    action: execute
    file: recipe-steps/dev/build-uberjar.sh

  - name: run the jar
    action: execute_async
    file: recipe-steps/dev/run-dev-app.sh

  - name: run the movies producer
    action: execute
    file: recipe-steps/dev/console-producer-movies.sh
    stdin: recipe-steps/dev/movies.json

  - name: run the consumer
    action: execute_async
    file: recipe-steps/dev/console-consumer.sh
    stdout: recipe-steps/dev/outputs/rated-movies.json

  - name: run the ratings producer
    action: execute
    file: recipe-steps/dev/console-producer-ratings.sh
    stdin: recipe-steps/dev/ratings.json

  - name: wait for the joins to process
    action: sleep
    ms: 5000
