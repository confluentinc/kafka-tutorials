<div class="recipe-try-it-step">
  <h4 class="subtitle is-4">1. Get Confluent Platform</h4>

  <p>If you haven't already, get Confluent Platform.</p>
  <pre class="snippet"><code class="shell">{% include shared-content/docker-install.txt %}</code></pre>
</div>

<div class="recipe-try-it-step">
  <h4 class="subtitle is-4">2. Initialize the project</h4>

  <p>To get started, make a new directory anywhere you'd like for this project:</p>
  <pre class="snippet"><code class="shell">{% include_raw recipes/splitting/kstreams/code/recipe-steps/dev/init.sh %}</code></pre>

  <p>Then create the following Gradle build file, named <code>build.gradle</code> for the project:</p>
  <pre class="snippet"><code class="groovy">{% include_raw recipes/splitting/kstreams/code/build.gradle %}</code></pre>

  <p>Next, create a directory for configuration data:</p>
  <pre class="snippet"><code class="shell">{% include_raw recipes/splitting/kstreams/code/recipe-steps/dev/make-configuration-dir.sh %}</code></pre>

  <p>Then create a development file at <code>configuration/dev.properties</code>:</p>
  <pre class="snippet"><code class="shell">{% include_raw recipes/splitting/kstreams/code/configuration/dev.properties %}</code></pre>
</div>

<div class="recipe-try-it-step">
  <h4 class="subtitle is-4">3. Create a schema for the events</h4>

  <p>Create a directory for the schemas that represent the events in the stream:</p>
  <pre class="snippet"><code class="shell">{% include_raw recipes/splitting/kstreams/code/recipe-steps/dev/make-avro-dir.sh %}</code></pre>

  <p>Then create the following Avro schema file at <code>src/main/avro/acting_event.avsc</code> for the acting appearance events:</p>
  <pre class="snippet"><code class="avro">{% include_raw recipes/splitting/kstreams/code/src/main/avro/acting_event.avsc %}</code></pre>

  <p>Because we will use this Avro schema in our Java code, we'll need to compile it. Run the following:</p>
  <pre class="snippet"><code class="shell">{% include_raw recipes/splitting/kstreams/code/recipe-steps/dev/build-project.sh %}</code></pre>
</div>

<div class="recipe-try-it-step">
  <h4 class="subtitle is-4">4. Create the Kafka Streams topology</h4>

  <p>Create a directory for the Java files in this project:</p>
  <pre class="snippet"><code class="shell">{% include_raw recipes/splitting/kstreams/code/recipe-steps/dev/make-src-dir.sh %}</code></pre>

  <p>Then create the following file at <code>src/main/java/io/confluent/developer/SplitStream.java</code>. Notice the <code>buildTopology</code> method, which uses the Kafka Streams DSL. The <code>branch</code> method takes varargs of predicate functions over each record's key and value. <code>branch</code> returns an array of <code>KStream</code>, with the order of the array matching the the ordering of the predicates. If no predicates are matched, the event gets dropped from further processing. Notice the last predicate, which simply returns <code>true</code>. This acts as an "else" statement to catch all events that don't match the other predicates.</p>
  <pre class="snippet"><code class="java">{% include_raw recipes/splitting/kstreams/code/src/main/java/io/confluent/developer/SplitStream.java %}</code></pre>
</div>

<div class="recipe-try-it-step">
  <h4 class="subtitle is-4">5. Compile and run the Kafka Streams program</h4>

  <p>In your terminal, run:</p>
  <pre class="snippet"><code class="shell">{% include_raw recipes/splitting/kstreams/code/recipe-steps/dev/build-uberjar.sh %}</code></pre>

  <p>Now that an uberjar for the Kafka Streams application has been built, you can launch it locally. When you run the following, the prompt won't return, because the application will run until you exit it:</p>
  <pre class="snippet"><code class="shell">{% include_raw recipes/splitting/kstreams/code/recipe-steps/dev/run-dev-app.sh %}</code></pre>
</div>

<div class="recipe-try-it-step">
  <h4 class="subtitle is-4">6. Produce events to the input topic</h4>

  <p>In a new terminal, run:</p>
  <pre class="snippet"><code class="shell">{% include_raw recipes/splitting/kstreams/code/recipe-steps/dev/console-producer.sh %}</code></pre>

  <p>When the console producer starts, it will log some messages and hang, waiting for your input. Type in one line at a time and press enter to send it. Each line represents an event. To send all of the events below, paste the following into the prompt and press enter:</p>
  <pre class="snippet"><code class="json">{% include_raw recipes/splitting/kstreams/code/recipe-steps/dev/input-events.json %}</code></pre>
</div>

<div class="recipe-try-it-step">
  <h4 class="subtitle is-4">7. Consume the event subsets from the output topics</h4>

  <p>Leave your original terminal running. To consume the output events from each of the topic, you'll need to open several new terminal windows. In each instance, the prompt will hang, waiting for more events to arrive. To continue studying the example, send more events through the input terminal prompt. Otherwise, you can <code>Control-C</code> to exit the process.</p>

  <br/>

  <p>First, to consume the events of drama films, run the following:</p>
  <pre class="snippet"><code class="shell">{% include_raw recipes/splitting/kstreams/code/recipe-steps/dev/console-consumer-drama.sh %}</code></pre>

  <p>This should yield the following messages:</p>
  <pre class="snippet"><code class="json">{% include_raw recipes/splitting/kstreams/code/recipe-steps/dev/outputs/actual-drama-events.json %}</code></pre>

  <p>Second, to consume those from fantasy films, run the following:</p>
  <pre class="snippet"><code class="shell">{% include_raw recipes/splitting/kstreams/code/recipe-steps/dev/console-consumer-fantasy.sh %}</code></pre>

  <p>This should yield the following messages:</p>
  <pre class="snippet"><code class="json">{% include_raw recipes/splitting/kstreams/code/recipe-steps/dev/outputs/actual-fantasy-events.json %}</code></pre>

  <p>And finally, to consume all the other genres, run the following:</p>
  <pre class="snippet"><code class="shell">{% include_raw recipes/splitting/kstreams/code/recipe-steps/dev/console-consumer-other.sh %}</code></pre>

  <p>This should yield the following messages:</p>
  <pre class="snippet"><code class="json">{% include_raw recipes/splitting/kstreams/code/recipe-steps/dev/outputs/actual-other-events.json %}</code></pre>
</div>
