steps:
  - name: initialize
    action: execute
    file: recipe-steps/dev/init.sh

  - name: make the dir structure
    change_directory: join-stream-and-table
    action: execute
    file: recipe-steps/dev/make-dirs.sh

  - name: make a Docker Compose file
    action: make_file
    file: docker-compose.yml

  - name: bring up the containers
    action: execute_async
    file: recipe-steps/dev/docker-compose-up.sh

  - name: wait for the containers to start
    action: execute
    file: recipe-steps/dev/wait-for-containers.sh

  - name: run the CLI in Docker
    action: docker_ksql_cli_session
    container: ksql-cli
    docker_bootup_file: recipe-steps/dev/start-cli.sh
    stdin:
      - name: create the table for the movies
        file: recipe-steps/dev/create-movies-table.sql

      - name: create the stream of ratings
        file: recipe-steps/dev/create-ratings-stream.sql

      - name: populate the movies
        file: recipe-steps/dev/populate-movies.sql

      - name: populate the ratings
        file: recipe-steps/dev/populate-ratings.sql

      - name: set the dev props
        file: recipe-steps/dev/set-properties.sql

      - name: run the transient query
        file: recipe-steps/dev/transient-join.sql

      - name: run it continuously
        file: recipe-steps/dev/continuous-join.sql

      - name: print the topic
        file: recipe-steps/dev/print-output-topic.sql
    stdout:
      directory: recipe-steps/dev/outputs

  - name: populate the src file
    action: make_file
    file: src/statements.sql

  - name: clean up docker
    action: execute
    file: recipe-steps/dev/clean-up.sh
